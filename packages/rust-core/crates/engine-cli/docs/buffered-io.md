# バッファリングI/O

USIエンジンは、システムコール数を削減することでパフォーマンスを向上させるバッファリングI/Oをサポートしています。

## バッファリングI/Oの有効化

`buffered-io`フィーチャーを有効にしてビルドします：

```bash
cargo build -p engine-cli --features buffered-io
```

## 設定

バッファリング動作は環境変数で調整できます：

- `USI_FLUSH_DELAY_MS`: フラッシュ間隔（ミリ秒）（デフォルト: 100、範囲: 1-10000）
- `USI_FLUSH_MESSAGE_COUNT`: フラッシュするまでのメッセージ数（デフォルト: 10、範囲: 1-1000）

例：
```bash
USI_FLUSH_DELAY_MS=50 USI_FLUSH_MESSAGE_COUNT=20 ./engine-cli
```

## 動作

- 重要なメッセージ（usiok、readyok、bestmove）は常に即座にフラッシュされます
- infoメッセージは設定に基づいてバッファリングされます
- プログラム終了時にすべてのバッファされた出力がフラッシュされます

## パフォーマンスへの影響

バッファリングにより、探索中の大量の出力時にシステムコールを最大90%削減でき、特に多くのinfoメッセージを生成する際のエンジン全体のパフォーマンスが向上します。

## テスト

テスト用にバッファリングを無効化（即座にフラッシュ）：
```bash
USI_FLUSH_DELAY_MS=0 ./engine-cli
```

注意：0値の設定はテストビルドでのみ許可されています。本番環境では、誤設定を防ぐため最小値が適用されます。