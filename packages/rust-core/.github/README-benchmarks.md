# ベンチマーク戦略

## CI vs ローカル環境の使い分け

### CI環境（GitHub Actions）の役割
- **スモークテスト**: ビルドが壊れていないか確認
- **大きな性能劣化の検出**: 10%以上の劣化を検出
- **相対的な比較**: 同じCI環境での変化を追跡

**設定**:
- 深さ: 4
- スレッド: 1,2のみ
- 実行時間: 最大5分
- 目的: 基本的な動作確認

### ローカル環境の役割
- **正確な性能測定**: 本番環境に近い条件
- **詳細な分析**: 全スレッド構成、深い探索
- **最適化の効果測定**: 細かい性能変化を検出

**設定**:
- 深さ: 10以上
- スレッド: 1,2,4,8,16...
- 実行時間: 制限なし
- 目的: 実際の性能評価

## 推奨ワークフロー

1. **開発中**
   ```bash
   # クイックチェック（1-2分）
   QUICK=1 ./scripts/benchmark-baseline.sh run
   ```

2. **PR作成前**
   ```bash
   # ローカルでフルベンチマーク
   ./scripts/benchmark-baseline.sh run
   ./scripts/benchmark-baseline.sh save pr-xxx
   ```

3. **CI（自動実行）**
   - 基本的な動作確認のみ
   - 大きな劣化がないことを確認

4. **リリース前**
   ```bash
   # ローカルで詳細ベンチマーク
   ./scripts/benchmark-baseline.sh run
   ./scripts/benchmark-baseline.sh compare v1.0 current
   ```

## なぜこのアプローチか

1. **CI環境の制約**
   - 性能が不安定（共有環境）
   - 実行時間制限
   - CPUが弱い（2コア）

2. **ローカル環境の利点**
   - 一貫した性能
   - 本番環境に近い
   - 詳細な分析が可能

3. **バランスの取れた運用**
   - CIは「壊れていないか」の確認
   - ローカルは「どれだけ速いか」の測定

## 代替案

大規模プロジェクトでは以下も検討:
- 専用ベンチマークサーバー
- セルフホストランナー
- 定期的な手動ベンチマーク会