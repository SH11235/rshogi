{
  "$id": "gauntlet_out.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": ["env", "params", "summary", "series"],
  "properties": {
    "env": {
      "type": "object",
      "properties": {
        "cpu": {"type": "string"},
        "rustc": {"type": "string"},
        "commit": {"type": "string"},
        "toolchain": {"type": "string"}
      },
      "required": ["cpu", "rustc"]
    },
    "params": {
      "type": "object",
      "properties": {
        "time": {"type": "string"},
        "games": {"type": "integer", "minimum": 1},
        "threads": {"type": "integer", "minimum": 1},
        "hash_mb": {"type": "integer", "minimum": 1},
        "book": {"type": "string"},
        "multipv": {"type": "integer", "minimum": 1},
        "seed": {"type": ["integer", "null"]},
        "seed_mode": {"type": ["string", "null"], "enum": ["flat", "block", null]},
        "pv_ms": {"type": ["integer", "null"], "minimum": 1}
      },
      "required": ["time", "games", "threads", "hash_mb", "multipv"]
    },
    "summary": {
      "type": "object",
      "properties": {
        "winrate": {"type": "number", "minimum": 0, "maximum": 1, "description": "Score rate over all games (W=1, D=0.5, L=0). Kept as 'winrate' for backward compatibility."},
        "draw": {"type": "number", "minimum": 0, "maximum": 1},
        "nps_delta_pct": {"type": "number"},
        "pv_spread_p90_cp": {"type": "number"},
        "gate": {"enum": ["pass", "reject", "provisional"]},
        "reject_reason": {"type": "string"},
        "wins": {"type": "integer", "minimum": 0},
        "losses": {"type": "integer", "minimum": 0},
        "draws": {"type": "integer", "minimum": 0},
        "games": {"type": "integer", "minimum": 0},
        "nps_samples": {"type": ["integer", "null"], "minimum": 0},
        "pv_spread_samples": {"type": ["integer", "null"], "minimum": 0},
        "nnue_telemetry": {
          "type": "object",
          "properties": {
            "acc": {"type": "integer", "minimum": 0},
            "fb_hash_mismatch": {"type": "integer", "minimum": 0},
            "fb_acc_empty": {"type": "integer", "minimum": 0},
            "fb_feature_off": {"type": "integer", "minimum": 0},
            "apply_refresh_king": {"type": "integer", "minimum": 0},
            "apply_refresh_other": {"type": "integer", "minimum": 0}
          },
          "required": [
            "acc",
            "fb_hash_mismatch",
            "fb_acc_empty",
            "fb_feature_off",
            "apply_refresh_king",
            "apply_refresh_other"
          ],
          "additionalProperties": false
        }
      },
      "required": ["winrate", "draw", "nps_delta_pct", "pv_spread_p90_cp", "gate"],
      "additionalProperties": false
    },
    "training_config": {
      "type": "object",
      "description": "Optional: weighting and lr config baked into report"
    },
    "series": {
      "type": "array",
      "items": {"type": "object"}
    }
  }
}
