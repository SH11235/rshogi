
#!/usr/bin/env sh

echo "ğŸ“ Running lint-staged (format only)..."
lint-staged

staged_core_rs=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^packages/rust-core/.*\.rs$' || true)
if [ -n "$staged_core_rs" ]; then
    echo "ğŸ¦€ Rust files in packages/rust-core detected, running cargo fmt..."
    (cd packages/rust-core && cargo fmt --all)
    echo "$staged_core_rs" | xargs git add
fi

staged_tauri_rs=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^apps/desktop/src-tauri/.*\.rs$' || true)
if [ -n "$staged_tauri_rs" ]; then
    echo "ğŸ¦€ Rust files in apps/desktop/src-tauri detected, running cargo fmt..."
    (cd apps/desktop/src-tauri && cargo fmt --all)
    echo "$staged_tauri_rs" | xargs git add
fi
